Калибровка приёмника
====================

## Получение калибровочных значений

Удобнее всего выполнять калибровку в терминальном мультиплексоре, типа
`screen` или `tmux`. Такой позволяет оставить запущенную сессию, не
беспокоясь о возможности потери калибровочных сообщений из-за разрыва
ssh-соединения / исчерпания истории терминала. Рассмотрим на примере
работы с `screen`.

**Подготовительный этап:**

1.  Отключить NovAtelLogReader:

    <div class="captioned-content">

    <div class="caption">

    Остановка NovAtelLogReader

    </div>

    ``` bash
    docker kill <имя_контейнера>
    ```

    </div>

2.  Запустить `screen`-сессию с подключением к TTY-устройству:

    <div class="captioned-content">

    <div class="caption">

    Запуск screen-сессии

    </div>

    ``` bash
    screen /dev/<tty_устройство>
    ```

    </div>

**Калибровка и получение калибровочных значений:**

Далее, действия производятся в `screen`-сессии, созданном на предыдущем
шаге:

1.  Отключить логирование:

    ``` example
    UNLOGALL TRUE
    ```

    Необходимо дождаться завершения передачи сообщений приёмником. Затем
    можно отчистить экран при помощи сочетания клавиш `С-A : c l e a r`.

2.  Запустить запись сессии при помощи сочетания `C-A H`. Дальнейший лог
    сессии будет записываться в текущей директории, в файл `screen.*`.
    По окончанию калибровки можно будет извлечь из него калибровочные
    значения.

3.  Запустить калибровку и логирование сообщений:

    После отключения логирования нужно перевести приёмник в режим
    калибровки:

    ``` example
    ISMCALIBRATE enable 0 21600 60
    ```

    Затем необходимо активировать вывод калибровочных значений:

    ``` example
    LOG ISMCALIBRATIONSTATUSA ONNEW
    ```

4.  Отсоединиться от сессии при помощи сочетания `C-A D` и подключиться
    при помощи `screen -r`.

## Установка калибровочных значений в приёмник

GPStation-6 не устанавливает калибровочные коэффициенты самостоятельно,
о чём и говорится в официальном документе. Поэтому, их придётся
установить вручную.

**NOTE:** Коэффициенты, установленные в приёмник, влияют только на рассчитанный
приёмником ПЭС.

По окончанию калибровки (через 6 часов) нужно сохранить последнюю запись
из лога `ISMCALIBRATIONSTATUS` (`screen.*` в текущей директории).

``` example
#ISMCALIBRATIONSTATUSA,USB1,0,65.5,FINESTEERING,2216,175680.000,00800000,45d2,12832;21600,5,GPSL1CAL2Y,956,43.065361023,4.143943787,GLOL1CAL2P,560,16.367891312,8.583324432,GPSL1CAL2C,849,35.970966339,3.418408632,GPSL1CAL5,598,11.473398209,8.072864532,GLOL1CAL2CA,560,8.057802200,8.567287445*031c843a
```

Полученная строка содержит несколько кортежей с соответствующими
значениями калибровки:

``` example
GPSL1CAL2Y,956,43.065361023,4.143943787,
GLOL1CAL2P,560,16.367891312,8.583324432,
GPSL1CAL2C,849,35.970966339,3.418408632,
GPSL1CAL5,598,11.473398209,8.072864532,
GLOL1CAL2CA,560,8.057802200,8.567287445
```

Продолжить калибровку можно на существующей `screen`-сессии из
предыдущего этапа. Восстановить сессию при помощи `screen -r`, отключить
логирование и применить значения:

``` example
DIFFCODEBIASCONTROL enable
ISMTECCALIBRATION GPSL1CAL2Y  43.065361023
ISMTECCALIBRATION GLOL1CAL2P  16.367891312
ISMTECCALIBRATION GPSL1CAL2C  35.970966339
ISMTECCALIBRATION GPSL1CAL5   11.473398209
ISMTECCALIBRATION GLOL1CAL2CA 8.057802200
SAVECONFIG
```

Калибровка завершена. Можно окончательно завершить `screen`-сессию при
помощи сочетания `C-A \`.
